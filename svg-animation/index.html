<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>svg-animation</title>
  <style>
    * {
      padding: 0;
      margin: 0;
    }

    body {
      width: 100vw;
      /* height: 500vh; */
    }

    img {
      width: 100%;
      height: auto;
      vertical-align: bottom;
    }

    .contents {
      width: 100%;
      overflow: hidden;
    }

    .section {
      height: 100vh;
      background-image: repeating-linear-gradient(0deg, transparent, transparent 50px, rgb(252, 169, 169) 50px, rgb(252, 169, 169) 100px);
    }

    .eyesSection {
      width: 100%;
      height: 100vh;
      padding-top: 10%;
    }

    .eyesWrap {
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      width: 700px;
      background-color: grey;
    }

    .eyeOuter {
      width: 45%;
      aspect-ratio: 1 / 1.1;
      border: 1px solid #000;
      border-radius: 100%;
      position: relative;
      overflow: hidden;
    }

    .eye {
      width: 30%;
      aspect-ratio: 1 / 1.1;
      border-radius: 100%;
      background-color: #000;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      transition: transform 0.1s, width 0.2s;
    }

    .txtSection {
      width: 100%;
      position: relative;
    }

    .txt {
      /* display: flex; */
      /* flex-direction: column; */
      /* justify-content: center; */
      /* align-items: center; */
      margin: 0 auto;
      writing-mode: vertical-rl;
      z-index: 1;
      text-shadow: 0px 0px 3px #fff;
      white-space: nowrap;
    }

    .txt>span {
      display: inline-block;
      font-size: 2.7vh;
    }

    .txt>.mod-img {
      position: relative;
      width: 100%;
      height: 22vh;
    }

    .mod-img>img {
      width: auto;
      height: 100%;
      position: absolute;
      left: 50%;
      transform: translate(-31%, 0);
    }

    .pc {
      height: 45vh;
      aspect-ratio: 1842 / 1572;
      position: fixed;
      bottom: 0;
      left: 50%;
      transform-origin: 50% 56%;
    }

    @media screen and (max-width: 768px) {
      .pc {
        width: 70vw;
        height: auto;
      }
    }

    .pcBottom {
      height: 45vh;
      aspect-ratio: 1842 / 1572;
      position: fixed;
      bottom: 0;
      left: 50%;
      transform-origin: 50% 56%;
      z-index: 2;
    }

    @media screen and (max-width: 768px) {
      .pcBottom {
        width: 70vw;
        height: auto;
      }
    }

    .pcBottom>img {
      position: absolute;
      bottom: 0;
      z-index: 1;
    }

    .svgSection {
      width: 100%;
      /* height: 100%; */
    }

    .svgWrap {
      width: 150%;
    }

    .cls-1 {
      fill: none;
      stroke: #ff0000;
      stroke-miterlimit: 10;
      stroke-width: 5px;
      /* fill: #ff0000; */
    }

    .circle1 {
      transform: translate(189px, 92px);
      fill: #ff0000;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .circle2 {
      transform: translate(623px, 73px);
      fill: #ff0000;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .circle3 {
      transform: translate(1180px, 0px);
      fill: #ff0000;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .dot {
      fill: #000000;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollTrigger.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/MotionPathPlugin.min.js"></script>
</head>

<body>
  <main class="contents">
    <div class="eyesSection">
      <div id="js-eyesWrap" class="eyesWrap">
        <div class="eyeOuter left">
          <div id="js-leftEye" class="eye"></div>
        </div>
        <div class="eyeOuter right">
          <div id="js-rightEye" class="eye"></div>
        </div>
      </div>
    </div>
    <div class="section"></div>
    <div id="js-txtSection" class="txtSection">
      <p id="js-txt" class="txt">
        <span class="js-letter">あ</span>
        <span class="js-letter">な</span>
        <span class="js-letter">た</span>
        <span class="js-letter">の</span>
        <span class="js-letter mod-img">
          <img src="./txt1.png" alt="">
        </span>
        <span class="js-letter">お</span>
        <span class="js-letter">悩</span>
        <span class="js-letter">み</span>
        <span class="js-letter">解</span>
        <span class="js-letter">決</span>
        <span class="js-letter">で</span>
        <span class="js-letter">き</span>
        <span class="js-letter">る</span>
        <span class="js-letter">か</span>
        <span class="js-letter">も</span>
        <span class="js-letter">し</span>
        <span class="js-letter">れ</span>
        <span class="js-letter">ま</span>
        <span class="js-letter">せ</span>
        <span class="js-letter">ん</span>
        <span class="js-letter">。</span>
      </p>
      <figure id="js-pc" class="pc">
        <img src="./pc.png" alt="">
      </figure>
      <figure id="js-pcBottom" class="pcBottom">
        <img src="./pcBottom.png" alt="">
      </figure>
    </div>
    <div class="section"></div>
    <div id="js-svgSection" class="svgSection">
      <div class="svgWrap" id="js-svgWrap">
        <svg class="svg" viewBox="0 0 1832.52 367.44">
          <path id="js-line" class="cls-1"
                d="m1.15,247.07c23.06,16.18,59.15,38.3,107,55,50.85,17.75,163.77,57.17,251,1,49.7-32,104.98-104,81-158-23.47-52.85-111.4-62.7-169-43-28.77,9.84-80.58,37.53-82,78-.28,8,1.27,56.21,56.5,97.5,56.36,42.13,118.88,40.75,197.5,52.5,78.35,11.71,170.97,25.55,286-6,73.57-20.18,179.84-49.33,188-114,7.2-57.04-63.16-131.94-144-135-73.16-2.77-147.75,53.57-148,105-.4,84.6,200.37,157.51,336,178,194.65,29.41,330.35-37.79,356-51,64.87-33.43,173.35-89.32,168-170-5.16-77.82-114.71-155.93-200-130-60.54,18.4-111.4,89.99-102,152,20.21,133.23,318.16,219.01,553,204,40.14-2.57,73.25-7.74,96-12" />
          <path id="js-circle1" class="circle1"
                d="m251.02,52.4C227.56-.45,139.62-10.3,82.02,9.4,53.25,19.25,1.44,46.94.02,87.4c-.28,8,1.27,56.21,56.5,97.5,28.32,21.17,58.21,31.36,90.9,37.74,7.68-3.45,15.23-7.5,22.6-12.24,49.7-32,104.98-104,81-158Z" />
          <path id="js-circle2" class="circle2"
                d="m294,137.1C301.2,80.06,230.84,5.16,150,2.1,76.84-.67,2.25,55.67,2,107.1c-.24,50,69.8,95.91,155.12,129.34,63.91-19.83,130.49-48.69,136.88-99.34Z" />
          <path id="js-circle3" class="circle3"
                d="m305.13,137.07C299.97,59.25,190.41-18.86,105.13,7.07,44.59,25.47-6.28,97.06,3.13,159.07c8.57,56.53,67.15,104.51,149.69,139.88,65.21-34.06,157.25-87.41,152.31-161.88Z" />
          <circle id="js-dot" class="dot" cx="10" cy="10" r="10"></circle>
        </svg>
      </div>
    </div>
    <div class="section"></div>
  </main>
  <script>
    ((d, w) => {
      w.addEventListener('load', () => {
        let windowWidth = innerWidth;
        let windowHeight = innerHeight;

        const pc = 768;
        const pcMax = 1400;

        // 目アニメーション
        const eyesWrap = d.getElementById('js-eyesWrap');
        const leftEye = d.getElementById('js-leftEye');
        const rightEye = d.getElementById('js-rightEye');

        let x;
        let y;
        w.addEventListener('mousemove', (e) => {
          const mouse = {
            x: e.pageX,
            y: e.pageY,
          };
          const eyesCenter = {
            x: eyesWrap.getBoundingClientRect().left + eyesWrap.offsetWidth / 2,
            y: eyesWrap.getBoundingClientRect().top + eyesWrap.offsetHeight / 2,
          };
          x = Math.floor((eyesCenter.x - mouse.x) / eyesWrap.offsetWidth * 100);
          y = Math.floor((eyesCenter.y - mouse.y) / eyesWrap.offsetHeight * 100);
        });


        (function updateEyesPos() {
          leftEye.style.transform = `translate(calc(-50% - ${x}px), calc(-50% - ${y}px))`;
          rightEye.style.transform = `translate(calc(-50% - ${x}px), calc(-50% - ${y}px))`;
          requestAnimationFrame(updateEyesPos);
        }
        )();

        w.addEventListener('mousedown', () => {
          leftEye.style.width = '33%';
          rightEye.style.width = '33%';
        });

        w.addEventListener('mouseup', () => {
          leftEye.style.width = '30%';
          rightEye.style.width = '30%';
        });

        // テキストアニメーション
        const txtSection = d.getElementById('js-txtSection');
        const txt = d.getElementById('js-txt');
        const pcFig = d.getElementById('js-pc');
        const letter = d.querySelectorAll('.js-letter');
        const inhaleEnd = windowHeight * 2;
        const inhaleTxt = gsap.timeline({
          scrollTrigger: {
            trigger: txt,
            start: 'center center', // 'trigger, browser'
            end: '+=' + inhaleEnd, //アニメーション開始位置から2000px固定する
            scrub: true, //スクロール量に合わせてアニメーションが進む（数字も指定できる）
            pin: true, //トリガー要素を固定する
            // markers: true,
          }
        });

        const fig = '#js-pc, #js-pcBottom';
        gsap.set(fig, { xPercent: -50, yPercent: 100 });
        inhaleTxt
          .to(fig, {
            yPercent: 0,
            duration: 4,
          })
          .to(txt, {
            y: ()=>{ return -pcFig.offsetHeight},
            duration: 4,
          }, '<')
          .to(txt, {
            yPercent: 20,
            duration: 3,
          })
          .to(letter, {
            y: () => { return windowHeight * 0.5; },
            // autoAlpha: 0.5,
            rotate: 360,
            scale: 0,
            duration: 4,
            ease: "power3.in",
            stagger: {
              from: "end",
              each: 1 / letter.length * 2.5,
            }
          }, '<-0.1')
          .to(fig, {
            scale: () => { return windowHeight / pcFig.offsetHeight + 2.5; },
            duration: 3,
          })
          .to(fig, {
            opacity: 0
          });


        // 線引くアニメーション
        const svgSection = d.getElementById('js-svgSection');
        const svgWrap = d.getElementById('js-svgWrap');

        const line = d.getElementById('js-line');
        const lineLength = line.getTotalLength();
        line.style.strokeDasharray = lineLength + 'px';
        line.style.strokeDashoffset = lineLength + 'px';

        const circle1 = d.getElementById('js-circle1');
        const circle2 = d.getElementById('js-circle2');
        const circle3 = d.getElementById('js-circle3');

        const dot = d.getElementById('js-dot');

        let svgWrapWidth = svgWrap.offsetWidth;
        let svgHiddenWidth = svgWrapWidth - windowWidth;

        const drawEnd = '2000px';
        // const scrollX = gsap.to(svgSection, {
        //   duration: 0.5,
        //   xPercent: () => svgHiddenWidth / svgWrapWidth * -100,
        //   ease: "power1.inOut",
        //   paused: true,
        // });
        const drawLine = gsap.timeline({
          scrollTrigger: {
            trigger: svgSection,
            start: 'center center', // 'trigger, browser'
            end: '+=' + drawEnd, //アニメーション開始位置から2000px固定する
            scrub: true, //スクロール量に合わせてアニメーションが進む（数字も指定できる）
            pin: true, //トリガー要素を固定する
            // markers: true,
            onUpdate: (self) => {
              const progress = self.progress;
              // console.log(progress);
              if (progress >= 0.115) {
                circle1.style.opacity = '1';
              } else {
                circle1.style.opacity = '0';
              }

              if (progress >= 0.273) {
                circle2.style.opacity = '1';
              } else {
                circle2.style.opacity = '0';
              }

              if (progress >= 0.553) {
                circle3.style.opacity = '1';
              } else {
                circle3.style.opacity = '0';
              }

              // if (progress >= 0.38) {
              //   scrollX.play();
              // } else {
              //   scrollX.reverse();
              // }
            }
          }
        });


        drawLine
          .to(line, {
            strokeDashoffset: 0,
          })
          .to(dot, {
            motionPath: {
              path: line,
              align: line,
              alignOrigin: [0.5, 0.5]
            }
          }, 0)
          .to(svgWrap, {
            xPercent: svgHiddenWidth / svgWrapWidth * -100,
          }, 0.11);
      });
    })(document, window);
  </script>
</body>

</html>