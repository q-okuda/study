<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>stringLength</title>
</head>

<body>
  <h1>stringLength</h1>
  <input type="text" maxlength="5">
</body>
<script>
  // jsã®æ–‡å­—åˆ—ã®å†…éƒ¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¯UTF-16ã€‚
  // UTF-16ã«ã¯ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã¨ã„ã†ä»•çµ„ã¿ãŒã‚ã‚‹ã€‚
  // 1æ–‡å­—ï¼ˆ1ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰ã‚’è¤‡æ•°ã®ç¬¦å·ï¼ˆã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆï¼‰ã§è¡¨ç¾ã™ã‚‹ã€‚
  // ä¾‹ï¼‰ã€Œã‚ã€ãƒ»ãƒ»ãƒ»1ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€1ã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆ
  // ä¾‹ï¼‰ã€ŒğŸã€ãƒ»ãƒ»ãƒ»ï¼‘ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€2ã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆ
  // String.prototype.lengthã¯ã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆã‚’æ•°ãˆæ•°ãˆã¦ã„ã‚‹ã€‚
  console.log("ã‚".length); //=> 1
  console.log("ğŸ".length); //=> 2
  console.log("ğ©¸½".length); //=> 2
  // â€»2ã‚³ãƒ¼ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆä½¿ã†æ¼¢å­—ã‚‚å­˜åœ¨ã™ã‚‹ã€‚

  // è¦‹ãŸç›®ã®ã¾ã¾ã‚«ã‚¦ãƒ³ãƒˆã—ãŸã„ï¼ â†’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ¼”ç®—å­ã‚’ä½¿ç”¨ã€‚
  // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰æ¼”ç®—å­ã€Œ...ã€ãƒ»ãƒ»ãƒ»é…åˆ—ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å±•é–‹ã—ã¦é…åˆ—ã«æ ¼ç´ã™ã‚‹ã€‚
  // ï¼ˆhttps://qiita.com/akisx/items/682a4283c13fe336c547ï¼‰
  console.log([..."abc"]); //=> [ 'a', 'b', 'c' ]
  // ã“ã®ã‚„ã‚Šæ–¹ã§ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆå˜ä½ã§åŒºåˆ‡ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
  // ã—ãŸãŒã£ã¦ã€ä¸€æ—¦æ–‡å­—åˆ—ã‚’é…åˆ—åŒ–ã—ã€ãã®è¦ç´ æ•°ã‚’æ•°ãˆã‚Œã°ã€ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã‹ã©ã†ã‹ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ã¯ãªããªã‚‹ã€‚
  console.log([..."ã‚"].length); //=> 1
  console.log([..."ğŸ"].length); //=> 1
  console.log([..."ğ©¸½"].length); //=> 1

  // ã¨ã“ã‚ãŒã©ã£ã“ã„ãƒ»ãƒ»ãƒ»
  console.log([..."ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿"].length); //=> 7
  // ã“ã®çµµæ–‡å­—ã¯ã©ã†ã‚„ã‚‰7ã¤ã®ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒçµ„ã¿åˆã‚ã•ã£ã¦è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã£ã½ã„ã€‚ã€‚ã€‚
  console.log([..."ğŸ‡¯ğŸ‡µ"].length); //=> 2
  // æ—¥æœ¬å›½æ——ã‚‚ã€‚ã€‚ã€‚
  // çµµæ–‡å­—ã«ã¯ã€ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ã€1ã¤ã®çµµæ–‡å­—ã‚’æˆã™ã‚‚ã®ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚

  // ã˜ã‚ƒã‚ã©ã†ã™ã‚‹ï¼Ÿ
  // Intl.Segmenterã‚’ä½¿ç”¨ã€‚
  // æ–‡å­—åˆ—ã‚’æ›¸è¨˜ç´ ã‚„å˜èªã€æ–‡ã«åˆ†è§£ã§ãã‚‹APIã€‚ï¼ˆFireFoxã€IEã«ã¯éå¯¾å¿œã€‚ï¼‰
  // æ–‡å­—åˆ—ã‚’æ›¸è¨˜ç´ å˜ä½ã«åˆ†è§£ã™ã‚‹ã«ã¯ã€Intl.Segmenterã‚¯ãƒ©ã‚¹ã®granularityã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«graphemeã‚’æŒ‡å®šã€‚
  const segmenter = new Intl.Segmenter("ja", { granularity: "grapheme" });
  console.log([...segmenter.segment("ã‚ã„ã†ãˆãŠ")]);
  //=>
  // [
  //   { segment: 'ã‚', index: 0, input: 'ã‚ã„ã†ãˆãŠ' },
  //   { segment: 'ã„', index: 1, input: 'ã‚ã„ã†ãˆãŠ' },
  //   { segment: 'ã†', index: 2, input: 'ã‚ã„ã†ãˆãŠ' },
  //   { segment: 'ãˆ', index: 3, input: 'ã‚ã„ã†ãˆãŠ' },
  //   { segment: 'ãŠ', index: 4, input: 'ã‚ã„ã†ãˆãŠ' }
  // ]

  // é–¢æ•°å®šç¾©ã§ä½¿ã„ã‚„ã™ãã€‚
  function countGrapheme(string) {
    const segmenter = new Intl.Segmenter("ja", { granularity: "grapheme" });
    return [...segmenter.segment(string)].length;
  }

  // Intl.Segmenterã¯ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢ã‚„çµµæ–‡å­—ã®åˆæˆã‚‚è€ƒæ…®ã—ã¦ã„ã‚‹ã®ã§ã€ã‚ˆã‚Šæ­£ç¢ºãªæ–‡å­—æ•°ãŒã‚«ã‚¦ãƒ³ãƒˆã§ãã‚‹ã€‚
  console.log(countGrapheme("ã‚")); //=> 1
  console.log(countGrapheme("ğŸ")); //=> 1
  console.log(countGrapheme("ğ©¸½")); //=> 1
  console.log(countGrapheme("ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿")); //=> 1
  console.log(countGrapheme("ğŸ‡¯ğŸ‡µ")); //=> 1
  console.log(countGrapheme("ğŸ‘¨ğŸ»â€ğŸ’»")); //=> 1

  // ãŸã ã€FireFoxã€IEã§ã¯æœªå¯¾å¿œãªã®ã§çµµæ–‡å­—ã‚’ä½¿ã‚ã‚ŒãŸããªã„ã®ãªã‚‰çµµæ–‡å­—ç¦æ­¢ã§å®Ÿè£…ã—ãŸæ–¹ãŒè‰¯ã„ã€‚

  // https://qiita.com/suin/items/3da4fb016728c024eaca
  // https://qiita.com/akisx/items/682a4283c13fe336c547
  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/Segmenter
  // https://iwb.jp/javascript-remove-form-input-textarea-emoji/
</script>

</html>